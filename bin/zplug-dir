#!/usr/bin/env zsh
# Description: returns location of installed plugin

# Usage:
# zplug dir b4b4r07/enhancd  ->  will return path of repository with plugin

PLUGIN_NAME="$1"
PLUGIN_DIR=""

if ! __zplug::core::arguments::none>/dev/null 2>&1; then
    # `zplug` not sourced, possibly because
    # script running in non-interactive and
    # single-command shell.
    if [[ -n "$ZPLUG_HOME" && -e "$ZPLUG_HOME"/init.zsh ]]; then
        source "$ZPLUG_HOME"/init.zsh
    else
        echo "zplug-dir: zplug not found, maybe \$ZPLUG_HOME not set?\n" \
            && exit 1
    fi
fi

if [[ -z ${PLUGIN_NAME} ]]; then
    __zplug::io::print::f "--error" "zplug-dir: no plugin name provided\n" \
        && exit 1
fi

if ! __zplug::base::base::zpluged "${PLUGIN_NAME}"; then
    __zplug::io::print::f "--error" "zplug-dir: plugin not found - '${PLUGIN_NAME}'\n" \
        && exit 1
else
    PLUGIN_INFO=$(sed -E $'s,\x1b\\[[0-9;]*[a-zA-Z],,g' \
        <(__zplug::core::core::run_interfaces "info" "${PLUGIN_NAME}"))
    PLUGIN_DIR=$(grep -E '^\- dir:' <(echo $PLUGIN_INFO) | cut -d' ' -f 3 | \
        tr -d '\042')

    [[ -n "${PLUGIN_DIR}" ]] && printf "%s\n" "${PLUGIN_DIR}" || exit 1
fi
